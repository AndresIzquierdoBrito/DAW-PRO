@page
@using ENT0701.Models
@model ENT0701.Pages.Components.EjercicioFechaModel
@{
    ViewData["Title"] = "Fecha";
    DateTime Now = DateTime.Now;
    string today = Now.ToString("yyyy-MM-dd");
}
<form name="dateForm" method="post">
    <p>Los datos tienen las fechas entre 1-1-2016 y el 31-12-2018 :)</p>
    @if (Request.Method == "POST")
    {
        <h2>Orders</h2>
        <div class="dateBox">
            <label for="dateInput">Date: </label>
            <input type="date" name="dateInput" max="@today" value="@Request.Form["dateInput"]" required />
        </div>
        <input type="submit" name="action" value="Submit" />
        <div class="dateResultData">
            <table class="dateTable">
                @{
                    EjercicioFechaModel model = new EjercicioFechaModel(Model.Data);
                    List<string> storeNames = (from Stores in Model.Data.Stores
                                               select Stores.StoreName).ToList();

                    foreach (string store in storeNames)
                    {
                        <tr class="storeNameDate"><th colspan="3">@store</th></tr>
                        <tr>
                            <th>Order ID</th>
                            <th>Order Status</th>
                            <th>Order Date</th>
                            <th>Delay (days)</th>
                        </tr>

                        List<string[]> ordersData = model.GetStoreActiveOrders(store, DateTime.Parse(Request.Form["dateInput"]));
                        foreach(string[] dataRow in ordersData)
                        {
                            <tr>
                                <td>@dataRow[0]</td>    @* OrderID *@
                                <td>@(dataRow[1] == "1" ? "Pending" : "Processing")</td>    @* OrderStatus *@
                                <td>@dataRow[2]</td>    @* OrderDate *@
                                <td>@(!dataRow[3].Contains('-') ? "0" : dataRow[3].Substring(1))</td>    @* Delay(in days) *@
                            </tr>
                        }
                    }
                }
             </table>
        </div>
    }
    else
    {
        <div class="dateBox">
            <label for="dateInput">Date: </label>
            <input type="date" name="dateInput" max="@today" required />
        </div>
        <input type="submit" name="action" value="Submit" />

    }
</form>